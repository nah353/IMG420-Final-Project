[gd_scene load_steps=17 format=3 uid="uid://bqwyic7o1wngj"]

[ext_resource type="PackedScene" uid="uid://dcaspd2sytk8e" path="res://Scenes/player.tscn" id="1_jjgbg"]
[ext_resource type="PackedScene" uid="uid://b8jwc3m6aq53q" path="res://Scenes/enemy.tscn" id="1_jkdf5"]
[ext_resource type="Script" uid="uid://bjt0mrwbsns15" path="res://Scripts/Map.cs" id="1_wsu2k"]
[ext_resource type="Texture2D" uid="uid://ba5kb76c16noo" path="res://Assets/flashlightProgessBG.png" id="3_kry3j"]
[ext_resource type="Texture2D" uid="uid://hftomrbxivr8" path="res://Assets/flashlightBody.png" id="4_21xkr"]
[ext_resource type="Texture2D" uid="uid://cyqs8akryruku" path="res://Assets/flashlightProgress.png" id="5_6bp64"]
[ext_resource type="Texture2D" uid="uid://hlu3lmyfapj3" path="res://Assets/HealthBarUnder.png" id="9_d1ilt"]
[ext_resource type="Shader" uid="uid://bqdedkqwowo8u" path="res://Scripts/fog_overlay.gdshader" id="9_hptm8"]
[ext_resource type="Texture2D" uid="uid://cuiv70eevqbes" path="res://Assets/HealthBarUpper.png" id="10_6iyac"]
[ext_resource type="Texture2D" uid="uid://cqoic5m2211oq" path="res://Assets/noiseTexture(1).png" id="10_d1ilt"]
[ext_resource type="Texture2D" uid="uid://bstoctoyrbwff" path="res://Assets/Light_cone_small.png" id="11_6iyac"]
[ext_resource type="Texture2D" uid="uid://cu6imq0hwaa36" path="res://Assets/HealthBarProg.png" id="11_fdnlq"]
[ext_resource type="Script" uid="uid://xt80cgp5ilr4" path="res://Scripts/Light.cs" id="12_fdnlq"]
[ext_resource type="PackedScene" uid="uid://dhghd63xm85ks" path="res://Scenes/hud.tscn" id="13_fdnlq"]
[ext_resource type="PackedScene" uid="uid://bqo5ccbcw8fig" path="res://Scenes/map_chunk.tscn" id="15_k12tt"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_6iyac"]
shader = ExtResource("9_hptm8")
shader_parameter/fog_tex = ExtResource("10_d1ilt")
shader_parameter/fog_scroll_velocity = Vector2(0, 0)
shader_parameter/fog_strength = 0.950000045125

[node name="Main" type="Node2D" node_paths=PackedStringArray("MapChunk", "Camera")]
script = ExtResource("1_wsu2k")
MapChunk = NodePath("MapChunk")
Camera = NodePath("player/Camera2D")

[node name="MapChunk" parent="." instance=ExtResource("15_k12tt")]

[node name="player" parent="." instance=ExtResource("1_jjgbg")]
z_index = 1
position = Vector2(598, 327)
DrainPerSecond = 1.5
BatteryBarPath = NodePath("../CanvasLayer/Control/TextureProgressBar")
StaminaBarPath = NodePath("../CanvasLayer/Control/HealthBar")

[node name="Camera2D" type="Camera2D" parent="player"]

[node name="Enemy" parent="." instance=ExtResource("1_jkdf5")]
position = Vector2(215, 226)
scale = Vector2(1.5, 1.5)
collision_layer = 0
collision_mask = 0

[node name="Enemy2" parent="." instance=ExtResource("1_jkdf5")]
position = Vector2(1008, 394)
scale = Vector2(1.5, 1.5)
collision_layer = 0
collision_mask = 0

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Pivot" type="Node2D" parent="CanvasLayer"]

[node name="LightCone" type="Sprite2D" parent="CanvasLayer" node_paths=PackedStringArray("Pivot", "LightHitbox") groups=["light"]]
visible = false
position = Vector2(576, 324)
scale = Vector2(1.5, 1.5)
texture = ExtResource("11_6iyac")
script = ExtResource("12_fdnlq")
Pivot = NodePath("../Pivot")
LightHitbox = NodePath("../LightHitbox")

[node name="LightHitbox" type="CollisionPolygon2D" parent="CanvasLayer" groups=["light"]]
position = Vector2(576, 324)
scale = Vector2(6, 6)
polygon = PackedVector2Array(15, -18, 15, -17, 13, -17, 13, -16, 10, -16, 10, -15, 7, -15, 7, -14, 4, -14, 4, -13, 1, -13, 1, -12, -2, -12, -2, -11, -4, -11, -4, -10, -7, -10, -7, -9, -10, -9, -10, -8, -14, -8, -14, -7, -18, -7, -18, -6, -20, -6, -20, -5, -24, -5, -24, -4, -26, -4, -26, -3, -27, -3, -27, -2, -28, -2, -28, -1, -29, -1, -29, 0, -30, 0, -30, 2, -29, 2, -29, 3, -28, 3, -28, 4, -27, 4, -27, 5, -26, 5, -26, 6, -20, 6, -20, 7, -16, 7, -16, 8, -13, 8, -13, 9, -9, 9, -9, 10, -6, 10, -6, 11, -2, 11, -2, 12, 0, 12, 0, 13, 3, 13, 3, 14, 7, 14, 7, 15, 10, 15, 10, 16, 13, 16, 13, 17, 17, 17, 17, 18, 22, 18, 22, 17, 24, 17, 24, 16, 25, 16, 25, 15, 26, 15, 26, 14, 27, 14, 27, 11, 28, 11, 28, 5, 29, 5, 29, 1, 28, 1, 28, -9, 27, -9, 27, -13, 26, -13, 26, -15, 25, -15, 25, -16, 24, -16, 24, -17, 23, -17, 23, -18)

[node name="DynamicFog2D" type="DynamicFog2D" parent="CanvasLayer"]
LightGroup = "light"
z_index = 2

[node name="Fog" type="Sprite2D" parent="CanvasLayer/DynamicFog2D"]
texture_filter = 1
texture_repeat = 2
material = SubResource("ShaderMaterial_6iyac")

[node name="Control" type="Control" parent="CanvasLayer"]
z_index = 3
layout_mode = 3
anchors_preset = 0
offset_right = 40.0
offset_bottom = 40.0
metadata/_edit_use_anchors_ = true

[node name="TextureProgressBar" type="TextureProgressBar" parent="CanvasLayer/Control"]
texture_filter = 1
layout_mode = 1
anchors_preset = -1
anchor_top = -1.9
anchor_right = 1.4
anchor_bottom = -1.9
offset_left = 31.0
offset_top = 642.0
offset_right = 71.0
offset_bottom = 682.0
scale = Vector2(1.2399997, 1)
texture_under = ExtResource("3_kry3j")
texture_over = ExtResource("4_21xkr")
texture_progress = ExtResource("5_6bp64")

[node name="HealthBar" type="TextureProgressBar" parent="CanvasLayer/Control"]
texture_filter = 1
layout_mode = 0
offset_left = 31.0
offset_top = 602.0
offset_right = 159.0
offset_bottom = 642.0
scale = Vector2(1.2799994, 1)
value = 100.0
texture_under = ExtResource("9_d1ilt")
texture_over = ExtResource("10_6iyac")
texture_progress = ExtResource("11_fdnlq")

[node name="HUD" parent="." instance=ExtResource("13_fdnlq")]

[connection signal="BatteryUpdate" from="player" to="CanvasLayer/LightCone" method="OnBatteryUpdate"]
[connection signal="PlayerDeath" from="player" to="HUD" method="_on_player_player_death"]
